<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ciao, Italy! ğŸ‡®ğŸ‡¹ ç¾©å¤§åˆ©èœœæœˆæ‰‹å¸³</title>
    
    <!-- 1. å¼•å…¥ Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        terracotta: { 50: '#fff5f0', 100: '#ffe4d6', 200: '#ffcbb0', 300: '#ffa57e', 400: '#ff7647', 500: '#fa531e', 600: '#db3309', 700: '#b62208' },
                        olive: { 50: '#f4f7f0', 100: '#e5eddc', 200: '#cddbbf', 600: '#5d7a3e', 700: '#486030', 800: '#324422' }
                    },
                    fontFamily: {
                        serif: ['Playfair Display', 'serif'],
                        sans: ['Lato', 'sans-serif']
                    }
                }
            }
        }
    </script>

    <!-- 2. å¼•å…¥å­—å‹ -->
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=Lato:wght@400;700&display=swap" rel="stylesheet">

    <!-- 3. å¼•å…¥ React -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        body { background-color: #fbf7f0; overflow: hidden; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fadeIn { animation: fadeIn 0.4s ease-out forwards; }
        /* ç¢ºä¿åº•éƒ¨å°è¦½åˆ—ä¸æœƒæ“‹ä½å…§å®¹ */
        .content-area { padding-bottom: 80px; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        
        // ==========================================
        // ğŸ‘‡ğŸ‘‡ è¨­å®šå€åŸŸ ğŸ‘‡ğŸ‘‡
        // ==========================================

        const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbytsqFAEkQKSpDo5AWg2fF3rjmURYRLov1N0y-SL-PzULlsTHcshfT2cA35DlrvU_ZG2A/exec"; 
        const MY_TRIP_ID = "ITALY_TRIP";

        // ==========================================

        // --- å…§å»ºåœ–ç¤ºåº« (SVG) - ä¿®æ­£å‘½åéŒ¯èª¤ ---
        const Icons = {
            Sun: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="4"/><path d="M12 2v2"/><path d="M12 20v2"/><path d="m4.93 4.93 1.41 1.41"/><path d="m17.66 17.66 1.41 1.41"/><path d="M2 12h2"/><path d="M20 12h2"/><path d="m6.34 17.66-1.41 1.41"/><path d="m19.07 4.93-1.41 1.41"/></svg>,
            Cloud: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M17.5 19c0-1.7-1.3-3-3-3h-11C1.6 16 0 14.4 0 12.5 0 10.6 1.6 9 3.5 9c.1-.8.5-1.6 1.1-2.2C5.9 5.5 8 5.1 10 5.8c1.3-1.8 3.4-3 5.8-2.8 4 .3 7.1 3.8 7.1 7.9v.3C23.6 11.9 24 12.7 24 13.5c0 3-2.5 5.5-5.5 5.5h-1z"/></svg>,
            CloudRain: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242"/><path d="M16 14v6"/><path d="M8 14v6"/><path d="M12 16v6"/></svg>,
            MapPin: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"/><circle cx="12" cy="10" r="3"/></svg>,
            Navigation: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="3 11 22 2 13 21 11 13 3 11"/></svg>,
            Camera: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z"/><circle cx="12" cy="13" r="3"/></svg>,
            ShoppingBag: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4Z"/><path d="M3 6h18"/><path d="M16 10a4 4 0 0 1-8 0"/></svg>,
            ShoppingCart: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="8" cy="21" r="1"/><circle cx="19" cy="21" r="1"/><path d="M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12"/></svg>,
            Coffee: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M17 8h1a4 4 0 1 1 0 8h-1"/><path d="M3 8h14v9a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4Z"/><line x1="6" x2="6" y1="2" y2="4"/><line x1="10" x2="10" y1="2" y2="4"/><line x1="14" x2="14" y1="2" y2="4"/></svg>,
            AlertTriangle: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/><line x1="12" x2="12" y1="9" y2="13"/><line x1="12" x2="12.01" y1="17" y2="17"/></svg>,
            Train: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="16" height="16" x="4" y="3" rx="2"/><path d="M4 11h16"/><path d="M12 3v8"/><path d="m8 19-2 3"/><path d="m18 22-2-3"/><path d="M8 15h0"/><path d="M16 15h0"/></svg>,
            Plane: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M2 12h20"/><path d="M13 12l5-8"/><path d="M13 12l5 8"/></svg>, 
            Wallet: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M19 7V4a1 1 0 0 0-1-1H5a2 2 0 0 0 0 4h15a1 1 0 0 1 1 1v4h-3a2 2 0 0 0 0 4h3a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1"/><path d="M3 5v14a2 2 0 0 0 2 2h15a1 1 0 0 0 1-1v-4"/></svg>,
            Plus: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M5 12h14"/><path d="M12 5v14"/></svg>,
            Trash2: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></svg>,
            ExternalLink: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/><polyline points="15 3 21 3 21 9"/><line x1="10" x2="21" y1="14" y2="3"/></svg>,
            Share2: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/><line x1="8.59" x2="15.42" y1="13.51" y2="17.49"/><line x1="15.41" x2="8.59" y1="6.51" y2="10.49"/></svg>,
            FileSpreadsheet: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/><path d="M8 13h2"/><path d="M8 17h2"/><path d="M14 13h2"/><path d="M14 17h2"/></svg>,
            Loader2: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 12a9 9 0 1 1-6.219-8.56"/></svg>,
            Lock: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="18" height="11" x="3" y="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>,
            Users: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>,
            LogIn: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"/><polyline points="10 17 15 12 10 7"/><line x1="15" x2="3" y1="12" y2="12"/></svg>,
            LinkIcon: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/></svg>, // Renamed Link to LinkIcon
            MapIcon: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="3 6 9 3 15 6 21 3 21 18 15 21 9 18 3 21"/><line x1="9" x2="9" y1="3" y2="18"/><line x1="15" x2="15" y1="6" y2="21"/></svg>, // Renamed Map to MapIcon
            Settings: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.1a2 2 0 0 1-1-1.74v-.47a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.35a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></svg>,
            Gift: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="20 12 20 22 4 22 4 12"/><rect width="20" height="5" x="2" y="7"/><line x1="12" x2="12" y1="22" y2="7"/><path d="M12 7H7.5a2.5 2.5 0 0 1 0-5C11 2 12 7 12 7z"/><path d="M12 7h4.5a2.5 2.5 0 0 0 0-5C13 2 12 7 12 7z"/></svg>,
            CheckCircle2: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><path d="m9 12 2 2 4-4"/></svg>
        };

        // --- ç¨‹å¼é‚è¼¯ ---
        const { useState, useEffect } = React;

        const tripData = [
            {
                day: 1, date: "12/05 (äº”)", location: "å°åŒ— -> æœæ‹œ",
                weather: { temp: "18Â°C - 22Â°C", status: "Cloudy", icon: Icons.Cloud },
                highlights: ["é˜¿è¯é…‹èˆªç©º", "è±ªè¯å®¢æ©Ÿé«”é©—"],
                itinerary: [
                    { time: "20:00", type: "transport", title: "æ¡ƒåœ’æ©Ÿå ´é›†åˆ", desc: "ç¬¬äºŒèˆªå»ˆ é˜¿è¯é…‹èˆªç©ºåœ˜é«”æ«ƒå°" },
                    { time: "23:00", type: "transport", title: "æ­ä¹˜ EK367 é£›å¾€æœæ‹œ", desc: "é£›è¡Œæ™‚é–“ç´„ 9 å°æ™‚ 55 åˆ†" },
                ],
                tips: [
                    { type: "note", text: "é•·é€”é£›è¡Œå»ºè­°ç©¿è‘—å¯¬é¬†èˆ’é©è¡£ç‰©ï¼Œæ”œå¸¶é ¸æ•ã€‚" },
                    { type: "scam", text: "æ©Ÿå ´é›–ç„¶å®‰å…¨ï¼Œä½†è­·ç…§ç™»æ©Ÿè­‰è«‹éš¨èº«ä¿ç®¡ï¼Œå‹¿éš¨æ„æ“±ç½®ã€‚" }
                ]
            },
            {
                day: 2, date: "12/06 (å…­)", location: "æœæ‹œ -> ç±³è˜­",
                weather: { temp: "4Â°C - 10Â°C", status: "Sunny", icon: Icons.Sun },
                highlights: ["ç±³è˜­å¤§æ•™å ‚", "è‰¾æ›¼ç´äºŒä¸–è¿´å»Š", "ç±³è˜­ç‡‰é£¯"],
                itinerary: [
                    { time: "04:55", type: "transport", title: "æŠµé”æœæ‹œè½‰æ©Ÿ" },
                    { time: "09:05", type: "transport", title: "æ­ä¹˜ EK205 é£›å¾€ç±³è˜­" },
                    { time: "13:10", type: "transport", title: "æŠµé”ç±³è˜­é¦¬çˆ¾å½­è–©æ©Ÿå ´" },
                    { time: "ä¸‹åˆ", type: "spot", title: "ç±³è˜­å¤§æ•™å ‚ (Duomo)", desc: "ä¸–ç•Œç¬¬ä¸‰å¤§æ•™å ‚ï¼Œç™½è‰²å¤§ç†çŸ³å“¥å¾·å¼å»ºç¯‰ï¼Œå¤–è§€é›„å‰å…¸é›…ã€‚", link: "https://www.google.com/maps/search/?api=1&query=Duomo+di+Milano" },
                    { time: "ä¸‹åˆ", type: "spot", title: "è‰¾æ›¼ç´äºŒä¸–è¿´å»Š", desc: "ç±³è˜­çš„å¤§å®¢å»³ï¼Œæ™‚å°šåç‰Œèšé›†åœ°ã€‚è¸©é‡‘ç‰›åº§å…¬ç‰›è›‹è›‹æ“šèªªæœƒå¸¶ä¾†å¥½é‹ï¼", link: "https://www.google.com/maps/search/?api=1&query=Galleria+Vittorio+Emanuele+II" },
                    { time: "æ™šé¤", type: "food", title: "ç±³è˜­ç‡‰é£¯é¢¨å‘³æ–™ç†", desc: "é“åœ°ç•ªç´…èŠ±ç‡‰é£¯" },
                ],
                stay: "UNAHOTELS MALPENSA",
                mustBuy: ["ç¾©å¤§åˆ©å’–å•¡ç²‰ (Lavazza/Illy)", "ç²¾å“ (Gucci/Prada ç”¢åœ°åƒ¹)", "Kiko å½©å¦"],
                tips: [
                    { type: "scam", text: "ã€é˜²é¨™ã€‘ç±³è˜­å¤§æ•™å ‚å»£å ´å¦‚æœ‰é»‘äººå¼·è¡Œçµ¦ä½ æˆ´å¹¸é‹ç¹©(æ‰‹ç’°)ï¼Œè«‹é›™æ‰‹æ’å£è¢‹å¿«é€Ÿé›¢é–‹ï¼Œæˆ´ä¸Šå°±æœƒè¢«è¦éŒ¢ã€‚" },
                    { type: "scam", text: "ã€é˜²é¨™ã€‘æœ‰äººä¸»å‹•çµ¦é´¿å­é£¼æ–™ä¹Ÿè¦æ‹’çµ•ï¼Œæ‹å®Œç…§æœƒè¢«ç´¢å–é«˜é¡è²»ç”¨ã€‚" }
                ]
            },
            {
                day: 3, date: "12/07 (æ—¥)", location: "ç±³è˜­ -> é¦¬ç„¦é›·æ¹– -> ç¶­æ´›ç´",
                weather: { temp: "2Â°C - 8Â°C", status: "Cloudy", icon: Icons.Cloud },
                highlights: ["é¦¬ç„¦é›·æ¹–éŠèˆ¹", "ç¶­æ´›ç´åœ“å½¢ç«¶æŠ€å ´", "èŒ±éº—è‘‰æ•…å±…"],
                itinerary: [
                    { time: "ä¸Šåˆ", type: "spot", title: "é¦¬ç„¦é›·æ¹– (Lake Maggiore)", desc: "ç¾©å¤§åˆ©ç¬¬äºŒå¤§æ¹–ï¼Œé˜¿çˆ¾å‘æ–¯å±±è…³ä¸‹çš„çµ•ç¾æ¹–å…‰å±±è‰²ã€‚ç‰¹åˆ¥å®‰æ’éŠèˆ¹é«”é©—ã€‚", link: "https://www.google.com/maps/search/?api=1&query=Lake+Maggiore" },
                    { time: "ä¸‹åˆ", type: "transport", title: "å‰å¾€ç¶­æ´›ç´ (Verona)", desc: "ç´„ 164KM è»Šç¨‹" },
                    { time: "ä¸‹åˆ", type: "spot", title: "ç¶­æ´›ç´åœ“å½¢ç«¶æŠ€å ´", desc: "ä¿å­˜å®Œå¥½çš„å¤ç¾…é¦¬ç«¶æŠ€å ´ï¼Œç¾ç‚ºæ­ŒåŠ‡è¡¨æ¼”å ´åœ°ã€‚", link: "https://www.google.com/maps/search/?api=1&query=Verona+Arena" },
                    { time: "æ™šé¤", type: "food", title: "ç™¾å¹´æ•™å ‚ç¾©å¼æŠ«è–©", desc: "åœ¨æ”¹å»ºçš„æ•™å ‚ä¸­äº«ç”¨æŠ«è–©" }
                ],
                stay: "BEST WESTERN CTC HOTEL VERONA",
                mustBuy: ["æª¸æª¬é…’ (Limoncello)", "ç¾©å¤§åˆ©éºµæ¢é€ å‹ç£éµ"],
                tips: [
                    { type: "info", text: "ç¶­æ´›ç´æ˜¯ç¾…å¯†æ­èˆ‡èŒ±éº—è‘‰çš„æ•…é„‰ï¼Œå……æ»¿æ„›æƒ…çš„æ°›åœã€‚" }
                ]
            },
            {
                day: 4, date: "12/08 (ä¸€)", location: "ç¶­æ´›ç´ -> å¨å°¼æ–¯ -> å¸•å¤šç“¦",
                weather: { temp: "3Â°C - 9Â°C", status: "Rain", icon: Icons.CloudRain },
                highlights: ["è²¢å¤šæ‹‰éŠèˆ¹", "è–é¦¬å¯å»£å ´", "å¢¨é­šéºµ"],
                itinerary: [
                    { time: "ä¸Šåˆ", type: "transport", title: "å‰å¾€å¨å°¼æ–¯", desc: "ç´„ 46KM è»Šç¨‹" },
                    { time: "å…¨æ—¥", type: "spot", title: "å¨å°¼æ–¯æœ¬å³¶æ•£ç­–", desc: "è–é¦¬å¯å»£å ´ã€ç¸½ç£å®®ã€å˜†æ¯æ©‹ã€‚ç‰¹åˆ¥å®‰æ’ç•¶åœ°å°éŠå°è¦½å··å¼„ã€‚", link: "https://www.google.com/maps/search/?api=1&query=St+Mark+Square" },
                    { time: "é«”é©—", type: "spot", title: "è²¢å¤šæ‹‰é³³å°¾èˆ¹ (Gondola)", desc: "äº”äººä¸€è‰˜ï¼Œç©¿æ¢­æ°´å··æ„Ÿå—æµªæ¼«æ°›åœã€‚" },
                    { time: "åˆé¤", type: "food", title: "å¨å°¼æ–¯å¢¨é­šéºµä½ç‚¸æµ·é®®", desc: "ç¶“å…¸å¿…åƒï¼Œåƒå®Œå˜´å·´æœƒé»‘é»‘çš„å–”ï¼" },
                    { time: "ä¸‹åˆ", type: "free", title: "å–®é£›æ™‚å…‰", desc: "è‡ªç”±æ¢ç´¢å¨å°¼æ–¯å°åº—æˆ–äº«ç”¨ä¸‹åˆèŒ¶" },
                    { time: "æ™šä¸Š", type: "transport", title: "å‰å¾€å¸•å¤šç“¦", desc: "ç´„ 46KM è»Šç¨‹" }
                ],
                stay: "CROWNE PLAZA PADOVA",
                mustBuy: ["å¨å°¼æ–¯é¢å…· (è£é£¾ç”¨)", "ç»ç’ƒè£½å“ (Murano Glass)", "è•¾çµ²è£½å“ (Burano)"],
                tips: [
                    { type: "scam", text: "ã€é˜²é¨™ã€‘å¨å°¼æ–¯ç”¨é¤è«‹å…ˆç¢ºèªèœå–®åƒ¹æ ¼ï¼Œéƒ¨åˆ†é¤å»³æœƒæœ‰éš±è—çš„æ¡Œå¸ƒè²»æˆ–é«˜é¡æœå‹™è²»ã€‚" },
                    { type: "info", text: "å¨å°¼æ–¯è·¯é¢å¤šæ©‹æ¨‘éšæ¢¯ï¼Œå»ºè­°è¼•ä¾¿è£å‚™ï¼Œå¤§å‹è¡Œæé€šå¸¸æœƒå¯„æ”¾åœ¨éŠè¦½è»Šä¸Šã€‚" }
                ]
            },
            {
                day: 5, date: "12/09 (äºŒ)", location: "å¸•å¤šç“¦ -> ä½›ç¾…å€«æ–¯ -> è’™åœ°å¡è’‚å°¼",
                weather: { temp: "5Â°C - 12Â°C", status: "Sunny", icon: Icons.Sun },
                highlights: ["è–æ¯ç™¾èŠ±å¤§æ•™å ‚", "é ˜ä¸»å»£å ´", "ä½›ç¾…å€«æ–¯ç‰›æ’"],
                itinerary: [
                    { time: "ä¸Šåˆ", type: "transport", title: "å‰å¾€ä½›ç¾…å€«æ–¯", desc: "ç´„ 236KM è»Šç¨‹ï¼Œæ–‡è—å¾©èˆˆç™¼æºåœ°ã€‚" },
                    { time: "ä¸‹åˆ", type: "spot", title: "è–æ¯ç™¾èŠ±å¤§æ•™å ‚", desc: "å·¨å¤§çš„ç´…è‰²åœ“é ‚æ˜¯åœ°æ¨™ã€‚å¤©å ‚ä¹‹é–€ã€å–¬æ‰˜é˜æ¨“çš†åœ¨æ—ã€‚", link: "https://www.google.com/maps/search/?api=1&query=Cathedral+of+Santa+Maria+del+Fiore" },
                    { time: "ä¸‹åˆ", type: "spot", title: "é ˜ä¸»å»£å ´", desc: "éœ²å¤©çš„ç¾è¡“é¤¨ï¼Œæµ·ç¥å™´æ³‰èˆ‡å¤§è¡›åƒè¤‡è£½å“ã€‚", link: "https://www.google.com/maps/search/?api=1&query=Piazza+della+Signoria" },
                    { time: "åˆé¤", type: "food", title: "ä½›ç¾…å€«æ–¯ä¸éª¨ç‰›æ’", desc: "æ‰˜æ–¯å¡å°¼å¿…åƒç¾é£Ÿï¼Œå¤–ç„¦é¦™å…§é®®å«©ã€‚" },
                    { time: "æ™šä¸Š", type: "transport", title: "å‰å¾€è’™åœ°å¡è’‚å°¼", desc: "æº«æ³‰å°é®" }
                ],
                stay: "GRAND HOTEL CROCE DI MALTA",
                mustBuy: ["è•¾è‰æ­ (L'Erbolario) ä¿é¤Šå“", "çš®ä»¶ (The Bridge/å°åº—)", "æ¾éœ²é†¬"],
                tips: [
                    { type: "scam", text: "ã€é˜²é¨™ã€‘ä½›ç¾…å€«æ–¯æ™¯é»äººæ½®çœ¾å¤šï¼Œå°å¿ƒæ‰’æ‰‹è²¼èº«ã€‚å‰æ™®è³½å©¦å¥³æˆ–å°å­©é è¿‘è¦ç‰¹åˆ¥è­¦è¦ºã€‚" },
                    { type: "buy", text: "è–æ¯ç™¾èŠ±å¤§æ•™å ‚æ—çš„è•¾è‰æ­å°ˆè³£åº—é€šå¸¸æœ‰ä¸­æ–‡åº—å“¡ï¼Œä¸”é€è©¦ç”¨åŒ…å¾ˆå¤§æ–¹ï¼" }
                ]
            },
            {
                day: 6, date: "12/10 (ä¸‰)", location: "ä½›ç¾…å€«æ–¯ -> äº”æ¼æ‘ -> æ¯”è–©",
                weather: { temp: "6Â°C - 11Â°C", status: "Cloudy", icon: Icons.Cloud },
                highlights: ["äº”æ¼æ‘ç«è»ŠéŠ", "æ¯”è–©æ–œå¡”"],
                itinerary: [
                    { time: "ä¸Šåˆ", type: "transport", title: "å‰å¾€äº”æ¼æ‘ (Cinque Terre)", desc: "æ­ä¹˜ç«è»ŠéŠè¦½æ‡¸å´–ä¸Šçš„ç¹½ç´›å°é®ã€‚" },
                    { time: "æ´»å‹•", type: "spot", title: "äº”æ¼æ‘å·¡ç¦®", desc: "æ‹œè¨ªå…¶ä¸­å…©å€‹æ¼æ‘ï¼Œæ¬£è³åœ°ä¸­æµ·ç¾æ™¯èˆ‡å½©è‰²æˆ¿èˆã€‚", link: "https://www.google.com/maps/search/?api=1&query=Cinque+Terre" },
                    { time: "ä¸‹åˆ", type: "transport", title: "å‰å¾€æ¯”è–© (Pisa)", desc: "ç´„ 87KM è»Šç¨‹" },
                    { time: "ä¸‹åˆ", type: "spot", title: "æ¯”è–©æ–œå¡” & å¥‡è¹Ÿå»£å ´", desc: "ä¸–ç•Œéºç”¢ï¼Œå¿…æ‹æ¨å¡”ç…§ã€‚", link: "https://www.google.com/maps/search/?api=1&query=Leaning+Tower+of+Pisa" },
                ],
                stay: "AC HOTEL PISA",
                mustBuy: ["æ¯”è–©æ–œå¡”é€ å‹ç´€å¿µå“", "ç¾©å¤§åˆ©é¦™æ–™"],
                tips: [
                    { type: "info", text: "äº”æ¼æ‘è·¯é¢èµ·ä¼å¤§ï¼Œè«‹ç©¿è‘—å¥½èµ°çš„é‹å­ã€‚" },
                    { type: "scam", text: "ã€é˜²é¨™ã€‘æ¯”è–©æ–œå¡”å‘¨é‚Šæœ‰å¾ˆå¤šæµå‹•æ”¤è²©ï¼Œåƒ¹æ ¼è½å·®å¤§ï¼Œè¨˜å¾—æ®ºåƒ¹æˆ–ç›´æ¥å»æ­£è¦åº—é¢è³¼è²·ã€‚" }
                ]
            },
            {
                day: 7, date: "12/11 (å››)", location: "æ¯”è–© -> æ‰˜æ–¯å¡å°¼ -> ç¾…é¦¬",
                weather: { temp: "4Â°C - 10Â°C", status: "Sunny", icon: Icons.Sun },
                highlights: ["æ‰˜æ–¯å¡å°¼é…’èŠ", "çš®æ©è–©å±±åŸ", "å“é…’"],
                itinerary: [
                    { time: "ä¸Šåˆ", type: "transport", title: "å‰å¾€æ‰˜æ–¯å¡å°¼åœ°å€", desc: "äº«å—ç”°åœ’é¢¨å…‰" },
                    { time: "é«”é©—", type: "spot", title: "é…’èŠå“é…’é«”é©—", desc: "åƒè§€é…’èŠä¸¦å“åšé“åœ°è‘¡è„é…’ (Chianti/Montepulciano)ã€‚" },
                    { time: "ä¸‹åˆ", type: "spot", title: "çš®æ©è–© (Pienza)", desc: "æ•™å®—çš„ç†æƒ³åŸï¼Œå¥§çˆ¾æ°å±±è°·çš„çç ï¼Œä¸–ç•Œéºç”¢å±±åŸã€‚", link: "https://www.google.com/maps/search/?api=1&query=Pienza" },
                    { time: "æ™šä¸Š", type: "transport", title: "å‰å¾€ç¾…é¦¬", desc: "ç´„ 188KM è»Šç¨‹ï¼Œæ°¸æ†ä¹‹åŸã€‚" }
                ],
                stay: "WARMTHOTEL ROME",
                mustBuy: ["æ‰˜æ–¯å¡å°¼ç´…é…’ (Chianti)", "ç¾Šå¥¶èµ·å¸ (Pecorino)", "æ©„æ¬–æ²¹"],
                tips: [
                    { type: "buy", text: "çš®æ©è–©ä»¥ç¾Šå¥¶èµ·å¸èåï¼Œå–œæ­¡èµ·å¸çš„äººåƒè¬åˆ¥éŒ¯éè©¦åƒã€‚" }
                ]
            },
            {
                day: 8, date: "12/12 (äº”)", location: "ç¾…é¦¬å…¨æ—¥è§€å…‰",
                weather: { temp: "5Â°C - 12Â°C", status: "Sunny", icon: Icons.Sun },
                highlights: ["æ¢µè’‚å²¡", "é¬¥ç¸å ´", "è¨±é¡˜æ± ", "é‡‘æ¯å’–å•¡"],
                itinerary: [
                    { time: "ä¸Šåˆ", type: "spot", title: "è–å½¼å¾—å¤§æ•™å ‚ (æ¢µè’‚å²¡)", desc: "ä¸–ç•Œæœ€å¤§æ•™å ‚ï¼Œç±³é–‹æœ—åŸºç¾…ã€Šè–æ®¤ã€‹æ‰€åœ¨åœ°ã€‚éœ€å®‰æª¢æ’éšŠã€‚", link: "https://www.google.com/maps/search/?api=1&query=St.+Peter's+Basilica" },
                    { time: "æ™¯é»", type: "spot", title: "ç¾…é¦¬ç«¶æŠ€å ´ (Colosseum)", desc: "å¤ç¾…é¦¬é¬¥ç¸å ´ï¼Œåœ¨å¤–éƒ¨åƒè§€æ‹ç…§ã€‚", link: "https://www.google.com/maps/search/?api=1&query=Colosseum" },
                    { time: "ä¸‹åˆ", type: "spot", title: "ç‰¹é›·ç¶­å™´æ³‰ (è¨±é¡˜æ± )", desc: "èƒŒå°æ± ä¸Ÿç¡¬å¹£è¨±é¡˜é‡è¿”ç¾…é¦¬ã€‚", link: "https://www.google.com/maps/search/?api=1&query=Trevi+Fountain" },
                    { time: "ä¸‹åˆ", type: "spot", title: "è¥¿ç­ç‰™å»£å ´", desc: "ç¾…é¦¬å‡æœŸçš„å ´æ™¯ï¼Œç ´èˆ¹å™´æ³‰ã€‚" },
                    { time: "é«”é©—", type: "food", title: "é‡‘æ¯å’–å•¡ (Tazza d'Oro)", desc: "ç‰¹åˆ¥å®‰æ’æ¯äººä¸€æ¯ï¼Œå°±åœ¨è¬ç¥æ®¿æ—ã€‚" },
                    { time: "æ™šé¤", type: "food", title: "ç¾…é¦¬å°ç¾”ç¾Šé¢¨å‘³é¤", desc: "ç¾…é¦¬ç‰¹è‰²æ–™ç†" }
                ],
                stay: "WARMTHOTEL ROME",
                mustBuy: ["é‡‘æ¯å’–å•¡è±†/å·§å…‹åŠ›çƒ", "Bialetti æ‘©å¡å£º", "ç¾…é¦¬ç«¶æŠ€å ´ç£éµ"],
                tips: [
                    { type: "scam", text: "ã€é˜²é¨™ã€‘ç¾…é¦¬æ²»å®‰éœ€æœ€ç‚ºè¬¹æ…ã€‚åœ°éµã€å…¬è»Šä¸Šæ‰’æ‰‹æ¥µå¤šã€‚è¨±é¡˜æ± äººæ“ äººæ™‚èƒŒåŒ…è«‹èƒŒå‰é¢ã€‚" },
                    { type: "scam", text: "ã€é˜²é¨™ã€‘è¥¿ç­ç‰™å»£å ´é™„è¿‘ä¸è¦æ¥é™Œç”Ÿäººéçµ¦ä½ çš„ç«ç‘°èŠ±ã€‚" }
                ]
            },
            {
                day: 9, date: "12/13 (å…­)", location: "ç¾…é¦¬ -> Outlet -> æ©Ÿå ´",
                weather: { temp: "5Â°C - 11Â°C", status: "Cloudy", icon: Icons.Cloud },
                highlights: ["Designer Outlet", "æ»¿è¼‰è€Œæ­¸"],
                itinerary: [
                    { time: "ä¸Šåˆ", type: "spot", title: "Castel Romano Designer Outlet", desc: "ç¾…é¦¬è¿‘éƒŠå¤§å‹Outletï¼ŒGucci, Burberry, Ferragamo ç­‰å“ç‰Œã€‚", link: "https://www.google.com/maps/search/?api=1&query=Castel+Romano+Designer+Outlet" },
                    { time: "ä¸‹åˆ", type: "transport", title: "å‰å¾€ç¾…é¦¬é”æ–‡è¥¿æ©Ÿå ´", desc: "è¾¦ç†é€€ç¨…èˆ‡ç™»æ©Ÿæ‰‹çºŒ" },
                    { time: "14:55", type: "transport", title: "æ­ä¹˜ EK098 é£›å¾€æœæ‹œ", desc: "å¸¶è‘—æˆ°åˆ©å“å›å®¶" }
                ],
                tips: [
                    { type: "info", text: "é€€ç¨…è«‹é ç•™å……è¶³æ™‚é–“ï¼Œç¾©å¤§åˆ©é€€ç¨…æ’éšŠå¯èƒ½å¾ˆé•·ã€‚å–®å¼µç™¼ç¥¨æ»¿155æ­å…ƒå³å¯é€€ç¨…ã€‚" },
                    { type: "info", text: "æ‰‹æè¡Œææ³¨æ„æ¶²é«”é™åˆ¶ï¼Œæ©„æ¬–æ²¹ã€é…’é¡å¿…é ˆæ‰˜é‹ã€‚" }
                ]
            },
            {
                day: 10, date: "12/14 (æ—¥)", location: "æœæ‹œ -> å°åŒ—",
                weather: { temp: "24Â°C", status: "Sunny", icon: Icons.Sun },
                highlights: ["ç”œèœœè¿”å®¶"],
                itinerary: [
                    { time: "23:30", type: "transport", title: "æŠµé”æœæ‹œ (å‰ä¸€æ—¥)" },
                    { time: "03:40", type: "transport", title: "æ­ä¹˜ EK366 é£›å¾€å°åŒ—" },
                    { time: "15:35", type: "transport", title: "æŠµé”æ¡ƒåœ’æ©Ÿå ´", desc: "æ—…ç¨‹åœ“æ»¿çµæŸ" }
                ],
                tips: []
            }
        ];

        // --- è³¼ç‰©æ¸…å–®è³‡æ–™ ---
        const shoppingData = [
            {
                region: "ç¾©å¤§åˆ© - ä½›ç¾…å€«æ–¯",
                items: [
                    { name: "L'Erbolario è•¾è‰æ­", desc: "å¿…è²·ï¼ç¾©å¤§åˆ©è‰æœ¬ä¿é¤Šå“ç‰Œï¼Œåƒ¹å·®èˆ‡å°ç£æ¥µå¤§ã€‚ç†±é–€ï¼š3é»éœ²ã€æµ·è—»ç²¾è¯ã€‚", tag: "åƒ¹å·®å¤§" },
                    { name: "çœŸçš®çš®ä»¶", desc: "ä½›ç¾…å€«æ–¯æ˜¯çš®ä»¶ä¹‹éƒ½ï¼ŒThe Bridge æˆ– Il Bisonte éƒ½æ˜¯å¥½é¸æ“‡ã€‚", tag: "è³ªæ„Ÿ" },
                    { name: "Marvis ç‰™è†", desc: "ç‰™è†ç•Œçš„æ„›é¦¬ä»•ï¼Œè¶…å¸‚å°±æœ‰è³£ï¼Œé€ç¦®è‡ªç”¨å…©ç›¸å®œã€‚", tag: "è¶…å¸‚" }
                ]
            },
            {
                region: "ç¾©å¤§åˆ© - ç¾…é¦¬ & å—éƒ¨",
                items: [
                    { name: "é‡‘æ¯å’–å•¡ (Tazza d'Oro)", desc: "ç¾…é¦¬è¬ç¥æ®¿æ—ï¼Œå¿…è²·ã€Œå’–å•¡è±†å·§å…‹åŠ›ã€èˆ‡å’–å•¡ç²‰ã€‚", tag: "å¿…åƒ" },
                    { name: "Pocket Coffee", desc: "è²»åˆ—ç¾…æ¨å‡ºçš„æ¿ƒç¸®å’–å•¡å·§å…‹åŠ›ï¼Œå’¬ä¸‹å»æœ‰æ¶²é«”å’–å•¡ï¼Œå†¬å­£é™å®šï¼", tag: "é™å®š" },
                    { name: "æª¸æª¬é…’ (Limoncello)", desc: "ç¾©å¤§åˆ©å—éƒ¨ç‰¹ç”¢ï¼Œé¤å¾Œç”œé…’ï¼Œé€ å‹ç“¶å­å¾ˆé©åˆç•¶ç´€å¿µå“ã€‚", tag: "é…’é¡" }
                ]
            },
            {
                region: "ç¾©å¤§åˆ© - å±…å®¶ & å½©å¦",
                items: [
                    { name: "Bialetti æ‘©å¡å£º", desc: "ç¾©å¤§åˆ©åœ‹æ°‘å£ºï¼Œæœ‰é¬å­è€é ­æ¨™èªŒï¼Œç…®å‡ºæœ€é“åœ°çš„ç¾©å¼æ¿ƒç¸®ã€‚", tag: "ç¶“å…¸" },
                    { name: "KIKO Milano", desc: "ç±³è˜­å¹³åƒ¹å½©å¦å“ç‰Œï¼Œå£ç´…è·Ÿçœ¼å½±CPå€¼è¶…é«˜ã€‚", tag: "å½©å¦" },
                    { name: "æ¾éœ²é†¬", desc: "è¶…å¸‚å¯è²·åˆ°å¹³åƒ¹æ¾éœ²é†¬ï¼Œæ‹Œéºµæˆ–å¡—éºµåŒ…éƒ½è¶…ç¾å‘³ã€‚", tag: "ç¾é£Ÿ" }
                ]
            },
            {
                region: "é˜¿è¯é…‹ - æœæ‹œè½‰æ©Ÿ",
                items: [
                    { name: "Bateel æ¤°æ£—", desc: "æ¤°æ£—ç•Œçš„LVï¼Œå£æ„Ÿç¶¿å¯†ï¼Œå¤¾æ ¸æ¡ƒæˆ–æ©˜çš®çš„æœ€å¥½åƒã€‚", tag: "å¥¢è¯" },
                    { name: "é§±é§å¥¶å·§å…‹åŠ›", desc: "Al Nassma å“ç‰Œï¼Œåšæˆé§±é§å½¢ç‹€ï¼Œéå¸¸ç‰¹åˆ¥çš„ä¼´æ‰‹ç¦®ã€‚", tag: "ç‰¹è‰²" },
                    { name: "Patchi å·§å…‹åŠ›", desc: "é»å·´å«©çš‡å®¤å·§å…‹åŠ›ï¼Œæœ‰ã€Œä¸­æ±Godivaã€ä¹‹ç¨±ï¼ŒåŒ…è£ç²¾ç¾ã€‚", tag: "ç”œé»" }
                ]
            }
        ];

        const Tag = ({ type, text }) => {
            const styles = {
                scam: "bg-red-50 text-red-700 border-red-200",
                buy: "bg-amber-50 text-amber-700 border-amber-200",
                info: "bg-blue-50 text-blue-700 border-blue-200",
                note: "bg-gray-50 text-gray-700 border-gray-200"
            };
            const iconMap = {
                scam: Icons.AlertTriangle,
                buy: Icons.ShoppingBag,
                info: Icons.Sun,
                note: Icons.Coffee
            };
            const IconComp = iconMap[type] || Icons.Sun;
            
            return (
                <div className={`text-xs px-2.5 py-1.5 rounded-md border mb-1.5 flex items-start ${styles[type] || styles.info}`}>
                    <span className="mt-0.5 shrink-0"><IconComp size={14} className="mr-1" /></span>
                    <span className="leading-relaxed">{text}</span>
                </div>
            );
        };

        const ItalyTravelApp = () => {
            const [activeTab, setActiveTab] = useState('itinerary'); 
            const [currentDay, setCurrentDay] = useState(1);
            const [scriptUrl, setScriptUrl] = useState(GOOGLE_SCRIPT_URL);
            const [tripId, setTripId] = useState(MY_TRIP_ID);
            const [isConfigured, setIsConfigured] = useState(!!GOOGLE_SCRIPT_URL);
            
            const [expenses, setExpenses] = useState([]);
            const [customSpots, setCustomSpots] = useState([]);
            const [isLoading, setIsLoading] = useState(false);

            const [newExpense, setNewExpense] = useState({ item: '', category: 'ç¾é£Ÿ', amount: '', currency: 'EUR' });
            const [newSpot, setNewSpot] = useState({ name: '', location: '', link: '', note: '' });

            // æª¢æŸ¥æ˜¯å¦å¾æœ¬åœ°å„²å­˜è®€å–è¨­å®š
            useEffect(() => {
                if (!GOOGLE_SCRIPT_URL) {
                    const savedScriptUrl = localStorage.getItem('italy_scriptUrl');
                    const savedTripId = localStorage.getItem('italy_tripId');
                    if (savedScriptUrl) {
                        setScriptUrl(savedScriptUrl);
                        setIsConfigured(true);
                    }
                    if (savedTripId) setTripId(savedTripId);
                }
            }, []);

            // è³‡æ–™åŒæ­¥
            useEffect(() => {
                if (isConfigured && scriptUrl) {
                    fetchData(); 
                    const interval = setInterval(fetchData, 10000); 
                    return () => clearInterval(interval);
                }
            }, [isConfigured, scriptUrl, tripId]);

            const fetchData = async () => {
                if (!scriptUrl) return;
                try {
                    const response = await fetch(`${scriptUrl}?tripId=${tripId}&_t=${new Date().getTime()}`);
                    const data = await response.json();
                    
                    if (data.expenses) {
                        data.expenses.sort((a, b) => b.timestamp.seconds - a.timestamp.seconds);
                        setExpenses(data.expenses);
                    }
                    if (data.spots) {
                        data.spots.sort((a, b) => b.timestamp.seconds - a.timestamp.seconds);
                        setCustomSpots(data.spots);
                    }
                } catch (error) {
                    console.error("åŒæ­¥å¤±æ•—:", error);
                }
            };

            const handleConfigSubmit = (e) => {
                e.preventDefault();
                if (scriptUrl.trim().length > 0) {
                    localStorage.setItem('italy_scriptUrl', scriptUrl);
                    localStorage.setItem('italy_tripId', tripId);
                    setIsConfigured(true);
                }
            };

            const handleAddExpense = async () => {
                if (!newExpense.item || !newExpense.amount) return;
                const newItem = { ...newExpense, type: 'expense', tripId };
                const tempItem = { ...newItem, id: Date.now(), timestamp: { seconds: Date.now()/1000 } };
                setExpenses([tempItem, ...expenses]);
                setNewExpense({ item: '', category: 'ç¾é£Ÿ', amount: '', currency: 'EUR' });

                if (scriptUrl) {
                    try {
                        await fetch(scriptUrl, {
                            method: 'POST',
                            mode: 'no-cors', 
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(newItem)
                        });
                    } catch (error) {
                        console.error("å¯«å…¥å¤±æ•—:", error);
                    }
                }
            };

            const handleAddSpot = async () => {
                if (!newSpot.name) return;
                const newItem = { ...newSpot, type: 'spot', tripId };
                const tempItem = { ...newItem, id: Date.now(), timestamp: { seconds: Date.now()/1000 } };
                setCustomSpots([tempItem, ...customSpots]);
                setNewSpot({ name: '', location: '', link: '', note: '' });

                if (scriptUrl) {
                    try {
                        await fetch(scriptUrl, {
                            method: 'POST',
                            mode: 'no-cors',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(newItem)
                        });
                    } catch (error) {
                        console.error("å¯«å…¥å¤±æ•—:", error);
                    }
                }
            };

            const copyToGoogleSheetFormat = () => {
                const header = "æ—¥æœŸ\tåˆ†é¡\tå“é …\tå¹£åˆ¥\té‡‘é¡\n";
                const body = expenses.map(e => {
                    const dateStr = new Date(e.timestamp.seconds * 1000).toLocaleDateString();
                    return `${dateStr}\t${e.category}\t${e.item}\t${e.currency}\t${e.amount}`;
                }).join("\n");
                navigator.clipboard.writeText(header + body).then(() => alert("è¨˜å¸³è³‡æ–™å·²è¤‡è£½ï¼\nè«‹è²¼ä¸Šåˆ° Google è¡¨æ ¼ã€‚"));
            };

            const copySpotsToGoogleSheetFormat = () => {
                const header = "æ—¥æœŸ\tåœ°å€\tåç¨±\té€£çµ\tå‚™è¨»\n";
                const body = customSpots.map(s => {
                    const dateStr = new Date(s.timestamp.seconds * 1000).toLocaleDateString();
                    return `${dateStr}\t${s.location}\t${s.name}\t${s.link}\t${s.note}`;
                }).join("\n");
                navigator.clipboard.writeText(header + body).then(() => alert("æ™¯é»è³‡æ–™å·²è¤‡è£½ï¼\nè«‹è²¼ä¸Šåˆ° Google è¡¨æ ¼ã€‚"));
            };

            const dayData = tripData.find(d => d.day === currentDay);
            const totalExpenseEUR = expenses.filter(e => e.currency === 'EUR').reduce((acc, curr) => acc + parseFloat(curr.amount || 0), 0);
            const totalExpenseAED = expenses.filter(e => e.currency === 'AED').reduce((acc, curr) => acc + parseFloat(curr.amount || 0), 0);

            if (!isConfigured) {
                return (
                    <div className="flex flex-col items-center justify-center h-screen px-8 text-center animate-fadeIn bg-terracotta-50">
                        <div className="w-20 h-20 bg-terracotta-100 rounded-full flex items-center justify-center mb-6 text-terracotta-600">
                            <Icons.Settings size={32} />
                        </div>
                        <h2 className="text-2xl font-serif font-bold text-gray-800 mb-2">åˆæ¬¡è¨­å®š</h2>
                        <p className="text-stone-500 text-sm mb-6">è«‹è¼¸å…¥ Apps Script ç¶²å€ä»¥å•Ÿç”¨é›²ç«¯åŠŸèƒ½ã€‚<br/>(å»ºè­°ç›´æ¥ä¿®æ”¹ç¨‹å¼ç¢¼ä¸­çš„ GOOGLE_SCRIPT_URL è®Šæ•¸ï¼Œä»¥å¾Œå°±ä¸ç”¨è¼¸å…¥äº†)</p>
                        <form onSubmit={handleConfigSubmit} className="w-full max-w-xs space-y-4">
                            <input type="text" placeholder="Apps Script ç¶²å€ (https://...)" className="w-full p-4 bg-white border border-stone-200 rounded-xl text-center text-xs text-stone-600 outline-none focus:ring-2 focus:ring-terracotta-200" value={scriptUrl} onChange={(e) => setScriptUrl(e.target.value)} />
                            <input type="text" placeholder="æ—…ç¨‹ä»£ç¢¼ (é¸å¡«)" className="w-full p-4 bg-white border border-stone-200 rounded-xl text-center text-sm font-bold tracking-widest uppercase outline-none focus:ring-2 focus:ring-terracotta-200" value={tripId} onChange={(e) => setTripId(e.target.value)} />
                            <button type="submit" className="w-full bg-terracotta-600 text-white py-4 rounded-xl font-bold shadow-lg shadow-terracotta-200 hover:bg-terracotta-700 active:scale-95 transition-all flex items-center justify-center gap-2">
                                <Icons.LinkIcon size={18} /> é–‹å§‹ä½¿ç”¨
                            </button>
                        </form>
                    </div>
                );
            }

            return (
                <div className="w-full h-screen bg-[#fbf7f0] font-sans text-gray-800 flex justify-center overflow-hidden">
                    <div className="w-full max-w-md h-full bg-[#fbf7f0] relative flex flex-col shadow-2xl">
                        <div className="bg-[#fbf7f0] px-5 pt-12 pb-2 flex justify-between items-center z-20">
                            <div>
                                <h1 className="font-serif text-2xl font-bold text-terracotta-700">Ciao, Italy! ğŸ‡®ğŸ‡¹</h1>
                                <p className="text-xs text-stone-500 font-medium tracking-wide flex items-center gap-1"><Icons.Lock size={10} /> Syncing: {tripId}</p>
                            </div>
                            <div className="w-8 h-8 rounded-full bg-white border border-stone-200 flex items-center justify-center text-stone-400 shadow-sm animate-pulse"><div className="w-2 h-2 bg-green-400 rounded-full"></div></div>
                        </div>

                        <div className="flex-1 overflow-y-auto no-scrollbar scroll-smooth content-area">
                            {activeTab === 'itinerary' && (
                                <div className="pb-4">
                                    <div className="sticky top-0 z-10 bg-[#fbf7f0] pt-2 pb-3 shadow-sm border-b border-stone-200 overflow-x-auto whitespace-nowrap px-4 no-scrollbar">
                                        <div className="flex gap-3">
                                            {tripData.map((d) => (
                                                <button key={d.day} onClick={() => setCurrentDay(d.day)} className={`flex flex-col items-center justify-center min-w-[4.5rem] h-16 rounded-xl transition-all duration-300 border-2 ${currentDay === d.day ? "bg-terracotta-600 border-terracotta-600 text-white shadow-md transform scale-105" : "bg-white border-stone-200 text-stone-500 hover:border-terracotta-300"}`}><span className="text-xs font-medium uppercase tracking-wider">Day</span><span className="text-xl font-serif font-bold">{d.day}</span></button>
                                            ))}
                                        </div>
                                    </div>
                                    <div className="px-5 pt-6 animate-fadeIn">
                                        <div className="bg-white rounded-2xl p-5 shadow-sm border border-stone-100 mb-6 relative overflow-hidden">
                                            <div className="absolute top-0 right-0 w-24 h-24 bg-terracotta-50 rounded-bl-full -mr-10 -mt-10 z-0"></div>
                                            <div className="relative z-10 flex justify-between items-start mb-2">
                                                <div><h2 className="text-2xl font-serif font-bold text-gray-800">{dayData.date}</h2><div className="flex items-center text-stone-500 text-sm mt-1"><Icons.MapPin size={14} className="mr-1" />{dayData.location}</div></div>
                                                <div className="flex flex-col items-end"><dayData.weather.icon className="text-terracotta-500 mb-1" size={28} /><span className="font-bold text-gray-700">{dayData.weather.temp}</span><span className="text-xs text-stone-400">{dayData.weather.status}</span></div>
                                            </div>
                                        </div>
                                        {dayData.highlights && <div className="mb-6"><div className="flex flex-wrap gap-2">{dayData.highlights.map((h, i) => <span key={i} className="px-3 py-1 bg-olive-100 text-olive-800 text-xs font-bold rounded-full border border-olive-200">#{h}</span>)}</div></div>}
                                        <div className="space-y-6">
                                            {dayData.itinerary.map((item, idx) => (
                                                <div key={idx} className="flex gap-4 group">
                                                    <div className="flex flex-col items-center"><div className={`w-3 h-3 rounded-full border-2 z-10 ${item.type === 'transport' ? 'bg-stone-200 border-stone-300' : item.type === 'food' ? 'bg-amber-100 border-amber-300' : 'bg-terracotta-100 border-terracotta-400'}`}></div>{idx !== dayData.itinerary.length - 1 && <div className="w-0.5 h-full bg-stone-100 -mt-1"></div>}</div>
                                                    <div className="flex-1 pb-2">
                                                        <div className="flex justify-between items-baseline mb-1"><span className="font-mono text-xs font-bold text-stone-400 bg-stone-50 px-1.5 rounded">{item.time}</span>{item.type === 'transport' && <Icons.Train size={14} className="text-stone-300" />}{item.type === 'spot' && <Icons.Camera size={14} className="text-terracotta-300" />}{item.type === 'food' && <Icons.Coffee size={14} className="text-amber-300" />}</div>
                                                        <div className={`p-3 rounded-xl border ${item.type === 'transport' ? 'bg-stone-50 border-stone-100' : 'bg-white border-stone-100 shadow-sm'}`}><h4 className="font-bold text-gray-800 flex items-center gap-2">{item.title}{item.link && <a href={item.link} target="_blank" rel="noreferrer" className="text-blue-400 hover:text-blue-600"><Icons.ExternalLink size={12} /></a>}</h4>{item.desc && <p className="text-sm text-stone-600 mt-1 leading-relaxed">{item.desc}</p>}</div>
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                        {dayData.stay && (
                                            <div className="mt-8 space-y-3">
                                                <div className="bg-blue-50 p-4 rounded-xl border border-blue-100 flex items-start gap-3">
                                                    <div className="bg-white p-2 rounded-full shadow-sm text-blue-500"><Icons.Sun size={20} className="fill-current" /></div>
                                                    <div>
                                                        <h5 className="text-xs font-bold text-blue-400 uppercase tracking-wide mb-1">Accommodation</h5>
                                                        <p className="font-serif font-bold text-blue-900">{dayData.stay}</p>
                                                    </div>
                                                </div>
                                                
                                                <a 
                                                    href={`https://www.google.com/maps/search/supermarket+near+${encodeURIComponent(dayData.stay)}`} 
                                                    target="_blank" 
                                                    rel="noreferrer"
                                                    className="block w-full bg-green-50 hover:bg-green-100 border border-green-200 p-3 rounded-xl flex items-center justify-center gap-2 text-green-700 font-bold transition-colors shadow-sm"
                                                >
                                                    <Icons.ShoppingCart size={18} />
                                                    æœå°‹é£¯åº—é™„è¿‘è¶…å¸‚
                                                </a>
                                            </div>
                                        )}
                                        {(dayData.mustBuy || dayData.tips.length > 0) && <div className="mt-8"><h3 className="text-center font-serif text-xl italic text-stone-400 mb-4">- Traveler's Notes -</h3>{dayData.mustBuy && <div className="mb-4 bg-white p-4 rounded-xl border border-dashed border-terracotta-300 relative"><div className="absolute -top-3 left-4 bg-[#fbf7f0] px-2 text-terracotta-600 font-bold text-xs flex items-center"><Icons.ShoppingBag size={12} className="mr-1"/> ä»Šæ—¥å¿…è²·</div><ul className="text-sm text-gray-700 space-y-1 mt-1 list-disc list-inside marker:text-terracotta-400">{dayData.mustBuy.map((item, i) => <li key={i}>{item}</li>)}</ul></div>}{dayData.tips.map((tip, i) => <Tag key={i} type={tip.type} text={tip.text} />)}</div>}
                                    </div>
                                </div>
                            )}
                            {activeTab === 'expenses' && (
                                <div className="px-5 pt-6 animate-fadeIn">
                                    <div className="flex justify-between items-center mb-6"><h2 className="text-2xl font-serif font-bold text-gray-800 flex items-center gap-2"><Icons.Wallet className="text-terracotta-500" /> æ—…è¡Œè¨˜å¸³</h2><button onClick={copyToGoogleSheetFormat} className="flex items-center gap-1 text-xs bg-green-100 text-green-700 px-3 py-1.5 rounded-full font-bold hover:bg-green-200 transition-colors"><Icons.FileSpreadsheet size={14} /> åŒ¯å‡º</button></div>
                                    <div className="grid grid-cols-2 gap-4 mb-8"><div className="bg-white p-4 rounded-xl shadow-sm border border-stone-100"><span className="text-xs text-stone-400 uppercase">Total (EUR)</span><div className="text-2xl font-bold text-gray-800 mt-1">â‚¬{totalExpenseEUR.toFixed(2)}</div></div><div className="bg-white p-4 rounded-xl shadow-sm border border-stone-100"><span className="text-xs text-stone-400 uppercase">Total (AED)</span><div className="text-2xl font-bold text-gray-800 mt-1">{totalExpenseAED.toFixed(2)} AED</div></div></div>
                                    <div className="bg-white p-5 rounded-2xl shadow-sm border border-stone-100 mb-8"><h3 className="font-bold text-gray-700 mb-4 text-sm">æ–°å¢æ¶ˆè²»</h3><div className="space-y-3"><input type="text" placeholder="å“é …" className="w-full p-3 bg-stone-50 rounded-lg text-sm outline-none" value={newExpense.item} onChange={(e) => setNewExpense({...newExpense, item: e.target.value})} /><div className="flex gap-3"><select className="flex-1 p-3 bg-stone-50 rounded-lg text-sm outline-none" value={newExpense.category} onChange={(e) => setNewExpense({...newExpense, category: e.target.value})}><option>ç¾é£Ÿ</option><option>è³¼ç‰©</option><option>ä¼´æ‰‹ç¦®</option><option>è¶…å¸‚</option><option>äº¤é€š</option></select><select className="w-24 p-3 bg-stone-50 rounded-lg text-sm outline-none" value={newExpense.currency} onChange={(e) => setNewExpense({...newExpense, currency: e.target.value})}><option value="EUR">â‚¬ EUR</option><option value="AED">AED</option></select></div><input type="number" placeholder="é‡‘é¡" className="w-full p-3 bg-stone-50 rounded-lg text-sm outline-none" value={newExpense.amount} onChange={(e) => setNewExpense({...newExpense, amount: e.target.value})} /><button onClick={handleAddExpense} className="w-full bg-terracotta-600 text-white py-3 rounded-lg font-bold text-sm hover:bg-terracotta-700 active:scale-95 transition-all">åŠ å…¥æ¸…å–®</button></div></div>
                                    <div className="space-y-3">{isLoading ? <div className="flex justify-center py-10 text-stone-300"><Icons.Loader2 className="animate-spin" /></div> : expenses.length === 0 ? <div className="text-center text-stone-400 py-8 text-sm italic">é‚„æ²’æœ‰æ¶ˆè²»ç´€éŒ„ï¼Œé–‹å§‹è²·è²·è²·å§ï¼</div> : expenses.map(ex => (<div key={ex.id} className="flex justify-between items-center bg-white p-4 rounded-xl border border-stone-100"><div className="flex items-center gap-3"><div className={`w-2 h-8 rounded-full ${ex.category === 'è³¼ç‰©' ? 'bg-pink-300' : ex.category === 'ç¾é£Ÿ' ? 'bg-amber-300' : ex.category === 'ä¼´æ‰‹ç¦®' ? 'bg-purple-300' : 'bg-stone-300'}`}></div><div><div className="font-bold text-gray-800 text-sm">{ex.item}</div><div className="text-xs text-stone-400">{ex.category}</div></div></div><div className="flex items-center gap-3"><span className="font-mono font-bold text-gray-600">{ex.currency === 'EUR' ? 'â‚¬' : 'AED'} {ex.amount}</span></div></div>))}</div>
                                </div>
                            )}
                            {activeTab === 'spots' && (
                                <div className="px-5 pt-6 animate-fadeIn">
                                    <div className="flex justify-between items-center mb-6"><h2 className="text-2xl font-serif font-bold text-gray-800 flex items-center gap-2"><Icons.MapIcon className="text-terracotta-500" /> è‡ªç”±è¡Œæ¢ç´¢</h2><button onClick={copySpotsToGoogleSheetFormat} className="flex items-center gap-1 text-xs bg-green-100 text-green-700 px-3 py-1.5 rounded-full font-bold hover:bg-green-200 transition-colors"><Icons.FileSpreadsheet size={14} /> åŒ¯å‡º</button></div>
                                    <div className="bg-white p-5 rounded-2xl shadow-sm border border-stone-100 mb-8 relative overflow-hidden"><div className="absolute top-0 right-0 w-20 h-20 bg-olive-50 rounded-bl-full -mr-8 -mt-8"></div><h3 className="font-bold text-gray-700 mb-4 text-sm relative z-10">æ–°å¢å£è¢‹åå–®</h3><div className="space-y-3 relative z-10"><div className="flex gap-3"><input type="text" placeholder="åç¨±" className="flex-1 p-3 bg-stone-50 rounded-lg text-sm outline-none" value={newSpot.name} onChange={(e) => setNewSpot({...newSpot, name: e.target.value})} /><select className="w-1/3 p-3 bg-stone-50 rounded-lg text-sm outline-none" value={newSpot.location} onChange={(e) => setNewSpot({...newSpot, location: e.target.value})}><option value="">åœ°å€</option><option>ç±³è˜­</option><option>å¨å°¼æ–¯</option><option>ä½›ç¾…å€«æ–¯</option><option>ç¾…é¦¬</option><option>å…¶ä»–</option></select></div><input type="text" placeholder="Google Maps é€£çµ" className="w-full p-3 bg-stone-50 rounded-lg text-sm outline-none" value={newSpot.link} onChange={(e) => setNewSpot({...newSpot, link: e.target.value})} /><textarea placeholder="å‚™è¨»" className="w-full p-3 bg-stone-50 rounded-lg text-sm outline-none resize-none h-20" value={newSpot.note} onChange={(e) => setNewSpot({...newSpot, note: e.target.value})} /><button onClick={handleAddSpot} className="w-full bg-olive-600 text-white py-3 rounded-lg font-bold text-sm hover:bg-olive-700 active:scale-95 transition-all">åŠ å…¥åœ°åœ–</button></div></div>
                                    <div className="space-y-4">{customSpots.length === 0 ? <div className="flex flex-col items-center justify-center py-10 text-stone-400"><Icons.MapIcon size={40} className="mb-2 opacity-20" /><span className="text-sm italic">å°‡æƒ³å»çš„åœ°æ–¹è¨˜éŒ„åœ¨é€™è£¡...</span></div> : customSpots.map(spot => (<div key={spot.id} className="bg-white p-4 rounded-xl border border-stone-100 shadow-sm relative overflow-hidden"><div className="flex justify-between items-start mb-2"><h4 className="font-bold text-gray-800">{spot.name}</h4>{spot.location && <span className="text-[10px] font-bold uppercase tracking-wider bg-stone-100 text-stone-500 px-2 py-0.5 rounded-full">{spot.location}</span>}</div><p className="text-xs text-stone-500 mb-3">{spot.note}</p><div className="flex justify-between items-center border-t border-stone-50 pt-2 mt-2">{spot.link ? (<a href={spot.link} target="_blank" rel="noreferrer" className="text-xs font-bold text-blue-500 flex items-center gap-1"><Icons.Navigation size={12} /> å°èˆª</a>) : <span></span>}</div></div>))}</div>
                                </div>
                            )}
                            {activeTab === 'shopping' && (
                                <div className="px-5 pt-6 animate-fadeIn">
                                    <div className="flex justify-between items-center mb-6"><h2 className="text-2xl font-serif font-bold text-gray-800 flex items-center gap-2"><Icons.ShoppingBag className="text-terracotta-500" /> å¿…è²·ä¼´æ‰‹ç¦®</h2></div>
                                    <div className="space-y-6">
                                        {shoppingData.map((section, idx) => (
                                            <div key={idx}>
                                                <h3 className="font-bold text-lg text-olive-700 mb-3 border-b-2 border-olive-100 pb-1">{section.region}</h3>
                                                <div className="space-y-3">
                                                    {section.items.map((item, i) => (
                                                        <div key={i} className="bg-white p-4 rounded-xl shadow-sm border border-stone-100 flex items-start gap-3">
                                                            <div className="bg-terracotta-50 p-2 rounded-full text-terracotta-500 mt-1"><Icons.Gift size={18} /></div>
                                                            <div className="flex-1">
                                                                <div className="flex justify-between items-start">
                                                                    <h4 className="font-bold text-gray-800">{item.name}</h4>
                                                                    <span className="text-[10px] bg-olive-100 text-olive-800 px-2 py-0.5 rounded-full font-bold">{item.tag}</span>
                                                                </div>
                                                                <p className="text-sm text-stone-500 mt-1 leading-relaxed">{item.desc}</p>
                                                            </div>
                                                        </div>
                                                    ))}
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            )}
                        </div>

                        <div className="fixed bottom-0 w-full max-w-md bg-white border-t border-stone-100 px-6 py-3 flex justify-between items-center z-30 shadow-[0_-5px_15px_rgba(0,0,0,0.02)]">
                            <button onClick={() => setActiveTab('itinerary')} className={`flex flex-col items-center gap-1 transition-colors ${activeTab === 'itinerary' ? 'text-terracotta-600' : 'text-stone-300'}`}><Icons.MapIcon size={22} className={activeTab === 'itinerary' ? 'fill-current' : ''} /><span className="text-[10px] font-bold">è¡Œç¨‹</span></button>
                            <button onClick={() => setActiveTab('spots')} className={`flex flex-col items-center gap-1 transition-colors ${activeTab === 'spots' ? 'text-olive-600' : 'text-stone-300'}`}><Icons.Plus size={24} className={`mb-1 p-0.5 rounded-full border-2 ${activeTab === 'spots' ? 'border-olive-600 bg-olive-50' : 'border-current'}`} /></button>
                            <button onClick={() => setActiveTab('expenses')} className={`flex flex-col items-center gap-1 transition-colors ${activeTab === 'expenses' ? 'text-terracotta-600' : 'text-stone-300'}`}><Icons.Wallet size={22} className={activeTab === 'expenses' ? 'fill-current' : ''} /><span className="text-[10px] font-bold">è¨˜å¸³</span></button>
                            <button onClick={() => setActiveTab('shopping')} className={`flex flex-col items-center gap-1 transition-colors ${activeTab === 'shopping' ? 'text-terracotta-600' : 'text-stone-300'}`}><Icons.ShoppingBag size={22} className={activeTab === 'shopping' ? 'fill-current' : ''} /><span className="text-[10px] font-bold">è³¼ç‰©</span></button>
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<ItalyTravelApp />);
    </script>
</body>
</html>
